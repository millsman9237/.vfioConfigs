# PUT YOUR CONFIG IN separate files
# in /etc/dracut.conf.d named "<name>.conf"
# SEE man dracut.conf(5) for options
# Dracut configuration for GPU passthrough
# This file configures dracut to use the same setup that was used with mkinitcpio
# to enable GPU passthrough using VFIO.

# MODULES section for Dracut
# Dracut includes configuration to add required kernel modules directly into the initramfs
# Specify the necessary modules to be loaded for GPU passthrough.
add_dracutmodules+=" vfio vfio_iommu_type1 vfio_pci vfio_virqfd "

# Include additional files
# This section includes the vfio-pci-override script directly into the dracut image.
install_items+=" /usr/bin/vfio-pci-override.sh "

# Add hooks to include early loading of vfio and other modules
# The "initqueue" hook allows early execution during the initramfs stage.
pre-udev+=
pre-mount+=" /usr/bin/vfio-pci-override.sh "

# Ensure essential dracut modules are loaded
# These dracut modules should be loaded for the image to properly initialize GPU passthrough.
dracutmodules+=" base systemd kernel-modules udev drm plymouth "

# Configuring compression for Dracut
# By default, use zstd for compression, like mkinitcpio.
compress="zstd"
